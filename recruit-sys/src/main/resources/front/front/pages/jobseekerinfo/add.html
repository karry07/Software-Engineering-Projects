<!doctype html>
<html class="no-js" lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>求职责信息填写</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" type="image/x-icon" href="../../assetsimages/x-icon/agricul.png">
	<link rel="stylesheet" href="../../assets/css/relys/animate.css">
	<link rel="stylesheet" href="../../assets/css/relys/bootstrap.min.css">
	<link rel="stylesheet" href="../../assets/css/relys/all.min.css">
	<link rel="stylesheet" href="../../assets/css/relys/icofont.min.css">
	<link rel="stylesheet" href="../../assets/css/relys/lightcase.css">
	<link rel="stylesheet" href="../../assets/css/relys/swiper.min.css">
	<link rel="stylesheet" href="../../assets/css/relys/style.css">
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
	<link rel="stylesheet" href="../../layui/css/layui.css">
	<style type="text/css">
		.form-box {
			padding-top: 50px; /* 顶部内边距 */
			padding-bottom: 50px; /* 底部内边距 */
			width: 100%;
			background: linear-gradient(to bottom, #bbe8da, #f2faf4); /* 背景颜色渐变 */
			display: flex;
			justify-content: center; /* 水平居中 */
			align-items: center; /* 垂直居中 */
		}

		/* 表单内容样式 */
		.form-box .form-content {
			width: 60%;
			height: auto;
			background: #f7fff7; /* 背景颜色 */
			padding: 40px 60px; /* 内边距 */
			border-radius: 10px; /* 圆角 */
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* 阴影 */
			position: relative;
		}

		/* 关闭按钮样式 */
		.form-box .form-content .close-btn {
			position: absolute;
			padding: 10px;
			background: #ccc; /* 背景颜色 */
			color: #444; /* 文字颜色 */
			top: 20px;
			right: 20px;
			border-radius: 50%; /* 圆形按钮 */
			cursor: pointer;
		}

		.form-box .form-content .close-btn:hover {
			background: #b3b3b3; /* 悬停时背景颜色 */
		}

		/* 标题样式 */
		.form-box .form-content h3 {
			text-align: center; /* 文字居中 */
			margin-bottom: 40px; /* 底部外边距 */
			font-size: 1.5em; /* 字体大小 */
			color: #333; /* 文字颜色 */
		}

		/* 输入项样式 */
		.form-box .form-content .input-item {
			margin-bottom: 20px; /* 底部外边距 */
			display: flex;
			align-items: center; /* 垂直居中 */
		}

		.form-box .form-content .input-item input,
		.form-box .form-content .input-item select,
		.form-box .form-content .input-item textarea {
			flex: 1;
			height: 40px; /* 高度 */
			padding: 0 10px; /* 内边距 */
			border: 1px solid #ddd; /* 边框 */
			border-radius: 5px; /* 圆角 */
			font-size: 14px; /* 字体大小 */
			color: #333; /* 文字颜色 */
		}

		.form-box .form-content .input-item textarea {
			height: 200px; /* 自动高度 */
			min-height: 100px; /* 最小高度 */
			resize: vertical; /* 允许垂直拉伸 */
			width: 500px; /* 宽度 */
		}

		.form-box .form-content .input-item .input-name {
			padding: 0;
			width: 120px; /* 宽度 */
			height: 40px; /* 高度 */
			line-height: 40px; /* 行高 */
			font-size: 14px; /* 字体大小 */
			color: #333; /* 文字颜色 */
			margin-right: 10px; /* 右外边距 */
		}

		/* 上传图片样式 */
		.form-box .form-content .input-item img {
			width: 100px; /* 宽度 */
			height: 100px; /* 高度 */
			border-radius: 5px; /* 圆角 */
			margin-left: 20px; /* 左外边距 */
			object-fit: cover; /* 保持比例 */
			margin-top: 5px;
		}

		/* 提交按钮样式 */
		.form-box .form-content button {
			background: #a5c7ec; /* 背景颜色 */
			color: #fff; /* 文字颜色 */
			border: none;
			width: 100%;
			padding: 10px; /* 内边距 */
			font-size: 16px; /* 字体大小 */
			border-radius: 5px; /* 圆角 */
			cursor: pointer;
			margin-top: 5px; /* 顶部外边距 */
		}

		.form-box .form-content button:hover {
			background: #3887de; /* 悬停时背景颜色 */
		}

		/* layui 上传图片样式 */
		.layui-upload-img {
			width: 120px; /* 宽度 */
			height: 120px; /* 高度 */
			border-radius: 5px; /* 圆角 */
			object-fit: cover; /* 保持比例 */
		}

		#zhaopianupload-img {
			line-height: 10px; /* 调整这个值以改变文本的垂直位置 */
		}
		#jianliupload-file{
			line-height: 10px; /* 调整这个值以改变文本的垂直位置 */
		}
	</style>
</head>
<body>
<div id="app">
	<div class="form-box layui-form" lay-filter="layform">
		<div class="form-control form-content">
			<h3>求职者个人信息填写</h3>
			<div>
				<div class="layui-form-item input-item">
					<label class="layui-form-label input-name">用户名</label>
					<div class="layui-input-block">
						<input v-model="detail.username" type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入用户名" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item input-item">
					<label class="layui-form-label input-name">姓名</label>
					<div class="layui-input-block">
						<input v-model="detail.fullname" type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入姓名" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item input-item">
					<label class="layui-form-label input-name">性别</label>
					<div class="layui-input-block">
						<input v-model="detail.gender" type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入性别" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item input-item">
					<label class="layui-form-label input-name">电话</label>
					<div class="layui-input-block">
						<input v-model="detail.phone" type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入电话" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item input-item">
					<label class="layui-form-label input-name">照片</label>
					<div class="layui-input-block">
						<button type="button" class="layui-btn" id="zhaopianupload-img" v-if="!detail.photo">上传图片</button>
						<div class="layui-upload-list" v-if="detail.photo">
							<img class="layui-upload-img" id="zhaopianimg-temp" :src="detail.photo?detail.photo.split(',')[0]:''">
							<p id="demoText"></p>
						</div>
					</div>
				</div>
				<div class="layui-form-item input-item">
					<label class="layui-form-label input-name">请选择学历</label>
					<div class="layui-input-block">
						<select id="education" name="interest" lay-filter="education">
							<option :value="item" v-for="(item,index) in xueliOptions">{{item}}</option>
						</select>
					</div>
				</div>
				<div class="layui-form-item input-item">
					<label class="layui-form-label input-name">请选择岗位类别</label>
					<div class="layui-input-block">
						<select id="jobcategory" name="interest" lay-filter="jobcategory">
							<option :value="item" v-for="(item,index) in jobcategoryOptions">{{item}}</option>
						</select>
					</div>
				</div>
				<div class="layui-form-item input-item">
					<label class="layui-form-label input-name">简历</label>
					<div class="layui-input-block">
						<button type="button" class="layui-btn" id="jianliupload-file">上传文件</button>
						<label v-if="detail.resume">{{detail.resume.split('upload/')[1]}}</label>
					</div>
				</div>
				<div class="layui-form-item layui-form-text input-item">
					<label class="layui-form-label input-name">工作经历</label>
					<div class="layui-input-block">
						<textarea v-model="detail.workexperience" placeholder="请输入工作经历" class="layui-textarea"></textarea>
					</div>
				</div>
				<div class="layui-form-item layui-form-text input-item">
					<label class="layui-form-label input-name">个人基本情况</label>
					<div class="layui-input-block">
						<textarea v-model="detail.personalinfo" id="text-editor"  style="display: none;"></textarea>
					</div>
				</div>
			</div>
			<button style="margin-bottom: 20px;" type="button" class="btn btn-default" @click="onConfirmTap">提交</button>
		</div>
	</div>
</div>
<script src="../../assets/js/relys/jquery.js"></script>
<script src="../../assets/js/relys/vue.min.js"></script>
<script src="../../assets/js/api/api.js"></script>
<script src="../../assets/js/api/tplist.js"></script>
<script src="../../assets/js/api/defaultuser.js"></script>
<script src="../../assets/js/relys/utils.js"></script>
<script src="../../assets/js/relys/storage.js"></script>
<script src="../../layui/layui.js"></script>
<div id="script"></div>
<script type="text/javascript">
	var app = new Vue({
		el: "#app",
		data: {
			crosstable: "",
			crosstableobj: {},
			detail: {
				username: "",
				fullname: "",
				gender: "",
				phone: "",
				photo: "",
				education: "",
				jobcategory: "",
				resume: "",
				workexperience: "",
				personalinfo: "",
				thumbsupnum: "",
				crazilynum: "",
			},
			xueliOptions: [],
			jobcategoryOptions: [],
		},
		computed: {
		},
		updated() {
			layui.form.render('select','layform');
		},
		async created() {
			var id = getParam('id')
			var tablename = getParam('tablename')
			this.crosstable = tablename
			if(tablename){
				var cross = JSON.parse(localStorage.getItem("crossObj"))
				this.crosstableobj = cross
				for(var key in cross){
					if("username" == key){
						this.detail[key] = cross[key]
					}
					if("fullname" == key){
						this.detail[key] = cross[key]
					}
					if("gender" == key){
						this.detail[key] = cross[key]
					}
					if("phone" == key){
						this.detail[key] = cross[key]
					}
					if("photo" == key){
						this.detail[key] = cross[key]
					}
					if("education" == key){
						this.detail[key] = cross[key]
					}
					if("jobcategory" == key){
						this.detail[key] = cross[key]
					}
					if("resume" == key){
						this.detail[key] = cross[key]
					}
					if("workexperience" == key){
						this.detail[key] = cross[key]
					}
					if("personalinfo" == key){
						this.detail[key] = cross[key]
					}
					if("thumbsupnum" == key){
						this.detail[key] = cross[key]
					}
					if("crazilynum" == key){
						this.detail[key] = cross[key]
					}
				}
			}else if(id){
				await this.getDetail(id, tablename)
			}

			// 获取用户信息
			var user = localStorage.getItem("sessionTable")
			session(`${user}`, (data)=>{
				if (data && data.code === 0) {
					var json = data.data;
					this.detail.username = json.username
					this.detail.fullname = json.fullname
					this.detail.gender = json.gender
					this.detail.phone = json.phone
				}
			})

			getOption("educationinfo", "education", (data) => {
				if (data && data.code === 0) {
					this.xueliOptions = data.data;
					this.detail.education = data.data[0]
				}
			})

			getOption("job_category", "jobcategory", (data) => {
				if (data && data.code === 0) {
					this.jobcategoryOptions = data.data;
					this.detail.jobcategory = data.data[0]
				}
			})

		},
		methods: {
			onPageTap(url) {
				window.location.href = url
			},
			updateTap(tablename, data){
				return new Promise((resolve) => {
					updateFun(tablename, data, (res) => {
						if(res&&res.code==0){
							console.log("更新成功")
							resolve(res)
						}
					})
				})

			},
			onConfirmTap(){
				var userConfirmation = confirm("提交就意味着您允许我们把您的信息公开给所有企业，是否确定？取消则退出本界面");
				// console.log(userConfirmation)
				if (userConfirmation) {
					addFun("jobseekerinfo", this.detail, (res) => {
						if (res && res.code == 0) {
							alert("提交成功");
							window.location.href = 'list.html';
						}
					});
				} else {
					window.location.href = 'list.html';
				}
			},


			getDetail(tablename, id) {
				return new Promise((resolve) => {
					detailFun(tablename, id, (res) => {
						this.detail = res.data
						resolve(res)
					})
				})
			}
		}
	})
	$(function(){
		layui.use('upload', function(){
			var $ = layui.jquery
					,upload = layui.upload;
			//普通图片上传
			var uploadInst = upload.render({
				elem: '#zhaopianupload-img'
				,url: baseurl+"file/upload" //改成您自己的上传接口
				,headers: {
					Token: getStorage("Token")
				}
				,before: function(obj){
					//预读本地文件示例，不支持ie8
					obj.preview(function(index, file, result){
						$('#zhaopianimg-temp').attr('src', result); //图片链接（base64）
					});
				}
				,done: function(res){
					//如果上传失败
					if(res.code > 0){
						return layer.msg('上传失败');
					}else{
						app.detail.photo = baseurl+"/upload/"+res.file
						return layer.msg('上传成功');
					}
					//上传成功
				}
			})
		});
		layui.use('upload', function(){
			var $ = layui.jquery
					,upload = layui.upload;
			//指定允许上传的文件类型
			upload.render({
				elem: '#jianliupload-file'
				,url: baseurl+"file/upload" //改成您自己的上传接口
				,headers: {
					Token: getStorage("Token")
				}
				,accept: 'file' //普通文件
				,done: function(res){
					//如果上传失败
					if(res.code > 0){
						return layer.msg('上传失败');
					}else{
						app.detail.resume = baseurl+"upload/"+res.file
						return layer.msg('上传成功');

					}
				}
			});
		});
		layui.use('layedit', function(){
			var layedit = layui.layedit;
			layedit.set({
				uploadImage: {
					url: baseurl+"file/upload" //接口url
					,headers: {
						Token: getStorage("Token")
					}
					,type: 'post' //默认post
				}
			});
			var index = layedit.build('text-editor'); //建立编辑器
			$("#btn-confirm").on("click", function(){
				app.detail.personalinfo = layedit.getContent(index)
				alert("编辑成功")
			})
		});
		layui.use(['form','layedit'], function(){
			var form = layui.form,
					layedit = layui.layedit,
					$ = layui.jquery,
					layer = layui.layer;

			form.on('select(education)', function(data){
				app.detail.education = data.value
			});
			form.on('select(jobcategory)', function(data){
				app.detail.jobcategory = data.value
			});
		});
	});
</script>
</body>
</html>
