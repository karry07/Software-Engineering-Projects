<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>详情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i&display=swap"
          rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon" href="../../assetsimages/x-icon/agricul.png">
    <link rel="stylesheet" href="../../assets/css/relys/animate.css">
    <link rel="stylesheet" href="../../assets/css/relys/bootstrap.min.css">
    <link rel="stylesheet" href="../../assets/css/relys/all.min.css">
    <link rel="stylesheet" href="../../assets/css/relys/icofont.min.css">
    <link rel="stylesheet" href="../../assets/css/relys/lightcase.css">
    <link rel="stylesheet" href="../../assets/css/relys/swiper.min.css">
    <link rel="stylesheet" href="../../assets/css/relys/style.css">
    <style type="text/css">
        .shop-thumb {
            height: 0;
            padding-top: 100%;
            position: relative;
            overflow: hidden;
        }

        .shop-thumb img {
            width: 50%;
            position: absolute;
            top: 20px;
            object-fit: cover;
            height: 50%;
            left: 100px;
        }

        .description img {
            width: 100%;
        }

        .thumbs-up, .thumbs-down {
            margin: 10px;
            padding: 5px 10px;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            display: inline-block;
        }

        .thumbs-up {
            background-color: #82d782;
        }

        .thumbs-down {
            background-color: #df8383;
        }

        h2 {
            font-size: 20px;
            color: #0be6c9;
            border-bottom: 2px solid #0be6c9;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }

        h4 {
            color: #0c0c0c;
            font-weight: normal;
        }

    </style>
</head>
<body>
<div id="app">
    <!-- Page Header Section Start Here -->
    <section class="page-header bg_img padding-tb">
        <div class="overlay"></div>
        <div class="container">
            <div class="page-header-content-area">
                <h4 class="ph-title">求职者信息详情</h4>
                <ul class="agri-ul">
                    <li><a href="../../index.html">首页</a></li>
                    <li><a class="active">求职者信息详情</a></li>
                </ul>
            </div>
        </div>
    </section>
    <!-- Page Header Section Ending Here -->
    <!-- Shop Page Section start here -->
    <section class="shop-single padding-tb">
        <div class="container">
            <div class="justify-content-center">
                <div class="col-lg-10 col-12 sticky-widget">
                    <div class="product-details">
                        <div class="row">
                            <div class="col-md-6 col-12">
                                <div class="swiper-slide" v-for="(item, i) in swiperList" :key="i">
                                    <div class="shop-thumb">
                                        <img :src="item" alt="shop-single">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-12">
                                <div class="post-content" v-if="detail">
                                    <h2>个人信息</h2>
                                    <h4>用户名：{{detail.username}}</h4>
                                    <h4>姓名：{{detail.fullname}}</h4>
                                    <h4>性别：{{detail.gender}}</h4>
                                    <h4>电话：{{detail.phone}}</h4>
                                    <h2>教育背景</h2>
                                    <h4>学历：{{detail.education}}</h4>
                                    <h4>专业类别：{{detail.jobcategory}}</h4>
                                    <h2>工作经验</h2>
                                    <h4>{{detail.workexperience}}</h4>
                                    <p class="rating"
                                       style="display: flex;justify-content: center;align-items: center;">
                                        <span class="thumbs-up"
                                              @click="onThumbsUp(1)">点赞 :{{detail.thumbsupnum}}</span>
                                        <span class="thumbs-down"
                                              @click="onThumbsUp(2)">点踩 :{{detail.crazilynum}}</span>
                                    </p>

                                    <div class="form">
                                        <button @click="download(`${detail.resume}`)">下载简历</button>
                                    </div>
                                    <div class="form">
                                        <button @click="getSuggestions">生成简历建议</button>
                                    </div>
                                    <div v-if="suggestions">
                                        <h2>简历建议</h2>
                                        <p>{{ suggestions }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="review">
                        <ul class="agri-ul review-nav">
                            <li class="desc active" data-target="description-show">详情</li>
                            <li :class="['rev', !hsdetail?'active':'']" data-target="review-content-show">评论
                                {{comments.length}}
                            </li>
                        </ul>
                        <div :class="['review-content', hsdetail?'description-show':'review-content-show']">
                            <div class="description" v-html="detail.personalinfo"></div>
                            <div class="review-showing">
                                <ul class="agri-ul content">
                                    <li v-for="(item, i) in comments" :key="i">
                                        <div class="post-thumb">
                                            <img src="../../assets/images/author.jpg" alt="shop">
                                        </div>
                                        <div class="post-content">
                                            <div class="entry-meta">
                                                <div class="posted-on">
                                                    <!--                                                <p>{{ item.userid }}</p >-->
                                                    <p>{{ item.username }}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ item.addtime
                                                        }}</p>
                                                </div>
                                            </div>
                                            <div class="entry-content">
                                                <p>{{item.content}}</p>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                                <div class="client-review">
                                    <div class="review-form">
                                        <div class="review-title">
                                            <h5>您的评论</h5>
                                        </div>
                                        <form @submit.prevent="onCommentTap" class="row">
                                            <div class="col-md-12 col-12">
                                                <textarea v-model="comment" rows="8"
                                                          placeholder="请填写评论"></textarea>
                                            </div>
                                            <div class="col-12">
                                                <button class="defult-btn" type="submit">提交</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
<script src="../../assets/js/relys/jquery.js"></script>
<script src="../../assets/js/relys/fontawesome.min.js"></script>
<script src="../../assets/js/relys/waypoints.min.js"></script>
<script src="../../assets/js/relys/bootstrap.min.js"></script>
<script src="../../assets/js/relys/wow.min.js"></script>
<script src="../../assets/js/relys/jquery.countdown.min.js"></script>
<script src="../../assets/js/relys/jquery.counterup.min.js"></script>
<script src="../../assets/js/relys/isotope.pkgd.min.js"></script>
<script src="../../assets/js/relys/lightcase.js"></script>
<script src="../../assets/js/relys/vue.js"></script>
<script src="../../assets/js/api/api.js"></script>
<script src="../../assets/js/api/tplist.js"></script>
<script src="../../assets/js/api/defaultuser.js"></script>
<script src="../../assets/js/relys/utils.js"></script>
<div id="script"></div>
</body>
<script type="text/javascript">
    var app = new Vue({
        el: "#app",
        data: {
            id: "",
            buynum: 1,
            detail: null,
            swiperList: [],
            curImg: '',
            hsdetail: false,
            comments: [],
            comment: "",
            buttons: [],
            suggestions: null,
        },
        async created() {
            var frontmenus = JSON.parse(localStorage.getItem("daohangmenus"))
            if (typeof frontmenus == "object") {
                frontmenus.forEach(item => {
                    if (item.menutable == "jobseekerinfo") {
                        this.buttons = item.buttons
                    }
                })
            }
            var id = getParam('id')
            this.id = id

            this.hsdetail = true

            await this.getDetail(id)
            this.getComments()
            var scripts = [
                "../../assets/js/relys/swiper.min.js",
                "../../assets/js/relys/functions.js"
            ]
            setTimeout(() => {
                scripts.forEach(ele => {
                    var new_element = document.createElement("script");
                    new_element.setAttribute("type", "text/javascript");
                    new_element.setAttribute("src", ele);// 在这里引入了a.js
                    $('#script').append(new_element);
                })
            }, 500)
        },
        methods: {
            download(file) {
                window.open(file)
            },
            onPageTap(url) {
                window.location.href = url;
            },
            getSession() {
                return new Promise((resolve) => {
                    var tablename = localStorage.getItem("sessionTable")
                    session(`${tablename}`, (data) => {
                        if (data && data.code == 0) {
                            resolve(data.data)
                        }
                    })
                })
            },
            getDetail(id) {
                return new Promise((resolve) => {
                    detailFun('jobseekerinfo', id, (res) => {
                        this.detail = res.data
                        this.$nextTick(() => {

                            this.swiperList = []
                            var arr = this.detail.photo.split(',')
                            arr.forEach(item => {
                                this.swiperList.push(item)
                            })
                            this.curImg = this.swiperList[0]
                            resolve(res)
                        })
                    })
                })
            },
            onThumbsUp(type) {
                thumbsUp("jobseekerinfo", this.detail.id, type, (res) => {
                    if (res && res.code == 0) {
                        if (type == 1) {
                            alert("点赞成功")
                            this.getDetail(this.id)
                        } else {
                            alert("踩成功")
                            this.getDetail(this.id)
                        }
                    }
                })
            },
            getComments() {
                commentList("job_post_comments", this.detail.id, (res) => {
                    if (res && res.code == 0) {
                        this.comments = res.data.list
                    }
                })
            },

            async onCommentTap() {
                var user = await this.getSession()
                if (user) {
                    var data = {
                        refid: this.detail.id,
                        content: this.comment,
                        userid: user.id,
                        username: user.companyname,
                    }
                    addComment("job_post_comments", data, (res) => {
                        if (res && res.code == 0) {
                            alert("评论成功")
                            this.comment = ""
                            this.getComments()
                        }
                    })
                } else {
                    alert("评论失败")
                }
            },
            async getSuggestions() {
                let url = 'api/generateResumeSuggestions';
                let data = this.detail;

                httpJson(url, 'POST', data, (response) => {
                    if (response && response.choices && response.choices.length > 0) {
                        this.suggestions = response.choices[0].text;
                    } else {
                        console.error('Error fetching suggestions:', response);
                    }
                });
            }

        }
    })
</script>
</html>