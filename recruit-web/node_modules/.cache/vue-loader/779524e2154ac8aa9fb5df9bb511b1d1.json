{"remainingRequest":"E:\\1\\Software-Engineering-Projects\\recruit-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\1\\Software-Engineering-Projects\\recruit-web\\src\\components\\common\\FileUpload.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\1\\Software-Engineering-Projects\\recruit-web\\src\\components\\common\\FileUpload.vue","mtime":1717224114232},{"path":"E:\\1\\Software-Engineering-Projects\\recruit-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1717224099637},{"path":"E:\\1\\Software-Engineering-Projects\\recruit-web\\node_modules\\babel-loader\\lib\\index.js","mtime":1717224098465},{"path":"E:\\1\\Software-Engineering-Projects\\recruit-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1717224099637},{"path":"E:\\1\\Software-Engineering-Projects\\recruit-web\\node_modules\\vue-loader\\lib\\index.js","mtime":1717224112413}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgc3RvcmFnZSBmcm9tICJAL3V0aWxzL3N0b3JhZ2UiOw0KaW1wb3J0IGJhc2UgZnJvbSAiQC91dGlscy9iYXNlIjsNCg0KZXhwb3J0IGRlZmF1bHQgew0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBkaWFsb2dWaXNpYmxlOiBmYWxzZSwNCiAgICAgIGRpYWxvZ0ltYWdlVXJsOiAiIiwNCiAgICAgIGZpbGVMaXN0OiBbXSwNCiAgICAgIGZpbGVVcmxMaXN0OiBbXSwNCiAgICAgIG15SGVhZGVyczoge30NCiAgICB9Ow0KICB9LA0KICBwcm9wczogWyJ0aXAiLCAiYWN0aW9uIiwgImxpbWl0IiwgIm11bHRpcGxlIiwgImZpbGVVcmxzIl0sDQogIG1vdW50ZWQoKSB7DQogICAgdGhpcy5pbml0KCk7DQogICAgdGhpcy5teUhlYWRlcnMgPSB7DQogICAgICAnVG9rZW4nOiBzdG9yYWdlLmdldCgiVG9rZW4iKQ0KICAgIH07DQogIH0sDQogIHdhdGNoOiB7DQogICAgZmlsZVVybHM6IGZ1bmN0aW9uKHZhbCkgew0KICAgICAgdGhpcy5pbml0KCk7DQogICAgfQ0KICB9LA0KICBjb21wdXRlZDogew0KICAgIGdldEFjdGlvblVybCgpIHsNCiAgICAgIGNvbnN0IHVybCA9IGAvJHt0aGlzLiRiYXNlLm5hbWV9L2AgKyB0aGlzLmFjdGlvbjsNCiAgICAvL2NvbnNvbGUubG9nKCdVcGxvYWQgVVJMOicsIHVybCk7DQogICAgcmV0dXJuIHVybDsNCiAgICB9DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBpbml0KCkgew0KICAgICAgaWYgKHRoaXMuZmlsZVVybHMpIHsNCiAgICAgICAgdGhpcy5maWxlVXJsTGlzdCA9IHRoaXMuZmlsZVVybHMuc3BsaXQoIiwiKTsNCiAgICAgICAgbGV0IGZpbGVBcnJheSA9IFtdOw0KICAgICAgICB0aGlzLmZpbGVVcmxMaXN0LmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7DQogICAgICAgICAgbGV0IGZpbGUgPSB7DQogICAgICAgICAgICBuYW1lOiBpbmRleCwNCiAgICAgICAgICAgIHVybDogaXRlbQ0KICAgICAgICAgIH07DQogICAgICAgICAgZmlsZUFycmF5LnB1c2goZmlsZSk7DQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLnNldEZpbGVMaXN0KGZpbGVBcnJheSk7DQogICAgICB9DQogICAgfSwNCiAgICBoYW5kbGVCZWZvcmVVcGxvYWQoZmlsZSkgew0KICAgICAgY29uc3QgaXNBbGxvd2VkVHlwZSA9IFsnaW1hZ2UvanBlZycsICdpbWFnZS9wbmcnLCAnYXBwbGljYXRpb24vcGRmJ10uaW5jbHVkZXMoZmlsZS50eXBlKTsNCiAgICAgIGNvbnN0IGlzTHQyTSA9IGZpbGUuc2l6ZSAvIDEwMjQgLyAxMDI0IDwgMjsNCg0KICAgICAgaWYgKCFpc0FsbG93ZWRUeXBlKSB7DQogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+S4iuS8oOaWh+S7tuWPquiDveaYryBKUEcsIFBORyDmiJYgUERGIOagvOW8jyEnKTsNCiAgICAgIH0NCiAgICAgIGlmICghaXNMdDJNKSB7DQogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+S4iuS8oOaWh+S7tuWkp+Wwj+S4jeiDvei2hei/hyAyTUIhJyk7DQogICAgICB9DQogICAgICByZXR1cm4gaXNBbGxvd2VkVHlwZSAmJiBpc0x0Mk07DQogICAgfSwNCiAgICBoYW5kbGVVcGxvYWRTdWNjZXNzKHJlcywgZmlsZSwgZmlsZUxpc3QpIHsNCiAgICAgIC8vY29uc29sZS5sb2coJ1VwbG9hZCBTdWNjZXNzIFJlc3BvbnNlOicsIHJlcyk7DQogICAgICBpZiAocmVzICYmIHJlcy5jb2RlID09PSAwKSB7DQogICAgICAgIGZpbGVMaXN0W2ZpbGVMaXN0Lmxlbmd0aCAtIDFdWyJ1cmwiXSA9IHRoaXMuJGJhc2UudXJsICsgInVwbG9hZC8iICsgZmlsZS5yZXNwb25zZS5maWxlOw0KICAgICAgICB0aGlzLnNldEZpbGVMaXN0KGZpbGVMaXN0KTsNCiAgICAgICAgdGhpcy4kZW1pdCgiY2hhbmdlIiwgdGhpcy5maWxlVXJsTGlzdC5qb2luKCIsIikpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGhhbmRsZVVwbG9hZEVycigpIHsNCiAgICAgIC8vY29uc29sZS5lcnJvcignVXBsb2FkIEVycm9yOicpOw0KICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5paH5Lu25LiK5Lyg5aSx6LSlIik7DQogICAgfSwNCiAgICBoYW5kbGVSZW1vdmUoZmlsZSwgZmlsZUxpc3QpIHsNCiAgICAgIHRoaXMuc2V0RmlsZUxpc3QoZmlsZUxpc3QpOw0KICAgICAgdGhpcy4kZW1pdCgiY2hhbmdlIiwgdGhpcy5maWxlVXJsTGlzdC5qb2luKCIsIikpOw0KICAgIH0sDQogICAgaGFuZGxlVXBsb2FkUHJldmlldyhmaWxlKSB7DQogICAgICB0aGlzLmRpYWxvZ0ltYWdlVXJsID0gZmlsZS51cmw7DQogICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSB0cnVlOw0KICAgIH0sDQogICAgaGFuZGxlRXhjZWVkKCkgew0KICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKGDmnIDlpJrkuIrkvKAgJHt0aGlzLmxpbWl0fSDlvKDlm77niYdgKTsNCiAgICB9LA0KICAgIHNldEZpbGVMaXN0KGZpbGVMaXN0KSB7DQogICAgICBsZXQgZmlsZUFycmF5ID0gW107DQogICAgICBsZXQgZmlsZVVybEFycmF5ID0gW107DQogICAgICBsZXQgdG9rZW4gPSBzdG9yYWdlLmdldCgidG9rZW4iKTsNCiAgICAgIGZpbGVMaXN0LmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgbGV0IHVybCA9IGl0ZW0udXJsLnNwbGl0KCI/IilbMF07DQogICAgICAgIGxldCBmaWxlID0gew0KICAgICAgICAgIG5hbWU6IGl0ZW0ubmFtZSwNCiAgICAgICAgICB1cmw6IHVybCArICI/dG9rZW49IiArIHRva2VuDQogICAgICAgIH07DQogICAgICAgIGZpbGVBcnJheS5wdXNoKGZpbGUpOw0KICAgICAgICBmaWxlVXJsQXJyYXkucHVzaCh1cmwpOw0KICAgICAgfSk7DQogICAgICB0aGlzLmZpbGVMaXN0ID0gZmlsZUFycmF5Ow0KICAgICAgdGhpcy5maWxlVXJsTGlzdCA9IGZpbGVVcmxBcnJheTsNCiAgICB9DQogIH0NCn07DQo="},{"version":3,"sources":["FileUpload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"FileUpload.vue","sourceRoot":"src/components/common","sourcesContent":["<template>\r\n  <div>\r\n    <!-- 上传文件组件 -->\r\n    <el-upload\r\n      ref=\"upload\"\r\n      :action=\"getActionUrl\"\r\n      list-type=\"picture-card\"\r\n      :multiple=\"multiple\"\r\n      :limit=\"limit\"\r\n      :headers=\"myHeaders\"\r\n      :file-list=\"fileList\"\r\n      :on-exceed=\"handleExceed\"\r\n      :on-preview=\"handleUploadPreview\"\r\n      :on-remove=\"handleRemove\"\r\n      :on-success=\"handleUploadSuccess\"\r\n      :on-error=\"handleUploadErr\"\r\n      :before-upload=\"handleBeforeUpload\"\r\n      accept=\".jpg,.jpeg,.png,.pdf\"\r\n    >\r\n      <i class=\"el-icon-plus\"></i>\r\n      <div slot=\"tip\" class=\"el-upload__tip\" style=\"color:#838fa1;\">{{ tip }}</div>\r\n    </el-upload>\r\n    <el-dialog :visible.sync=\"dialogVisible\" size=\"tiny\" append-to-body>\r\n      <img width=\"100%\" :src=\"dialogImageUrl\" alt>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport storage from \"@/utils/storage\";\r\nimport base from \"@/utils/base\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      dialogVisible: false,\r\n      dialogImageUrl: \"\",\r\n      fileList: [],\r\n      fileUrlList: [],\r\n      myHeaders: {}\r\n    };\r\n  },\r\n  props: [\"tip\", \"action\", \"limit\", \"multiple\", \"fileUrls\"],\r\n  mounted() {\r\n    this.init();\r\n    this.myHeaders = {\r\n      'Token': storage.get(\"Token\")\r\n    };\r\n  },\r\n  watch: {\r\n    fileUrls: function(val) {\r\n      this.init();\r\n    }\r\n  },\r\n  computed: {\r\n    getActionUrl() {\r\n      const url = `/${this.$base.name}/` + this.action;\r\n    //console.log('Upload URL:', url);\r\n    return url;\r\n    }\r\n  },\r\n  methods: {\r\n    init() {\r\n      if (this.fileUrls) {\r\n        this.fileUrlList = this.fileUrls.split(\",\");\r\n        let fileArray = [];\r\n        this.fileUrlList.forEach((item, index) => {\r\n          let file = {\r\n            name: index,\r\n            url: item\r\n          };\r\n          fileArray.push(file);\r\n        });\r\n        this.setFileList(fileArray);\r\n      }\r\n    },\r\n    handleBeforeUpload(file) {\r\n      const isAllowedType = ['image/jpeg', 'image/png', 'application/pdf'].includes(file.type);\r\n      const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n      if (!isAllowedType) {\r\n        this.$message.error('上传文件只能是 JPG, PNG 或 PDF 格式!');\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error('上传文件大小不能超过 2MB!');\r\n      }\r\n      return isAllowedType && isLt2M;\r\n    },\r\n    handleUploadSuccess(res, file, fileList) {\r\n      //console.log('Upload Success Response:', res);\r\n      if (res && res.code === 0) {\r\n        fileList[fileList.length - 1][\"url\"] = this.$base.url + \"upload/\" + file.response.file;\r\n        this.setFileList(fileList);\r\n        this.$emit(\"change\", this.fileUrlList.join(\",\"));\r\n      } else {\r\n        this.$message.error(res.msg);\r\n      }\r\n    },\r\n    handleUploadErr() {\r\n      //console.error('Upload Error:');\r\n      this.$message.error(\"文件上传失败\");\r\n    },\r\n    handleRemove(file, fileList) {\r\n      this.setFileList(fileList);\r\n      this.$emit(\"change\", this.fileUrlList.join(\",\"));\r\n    },\r\n    handleUploadPreview(file) {\r\n      this.dialogImageUrl = file.url;\r\n      this.dialogVisible = true;\r\n    },\r\n    handleExceed() {\r\n      this.$message.warning(`最多上传 ${this.limit} 张图片`);\r\n    },\r\n    setFileList(fileList) {\r\n      let fileArray = [];\r\n      let fileUrlArray = [];\r\n      let token = storage.get(\"token\");\r\n      fileList.forEach((item) => {\r\n        let url = item.url.split(\"?\")[0];\r\n        let file = {\r\n          name: item.name,\r\n          url: url + \"?token=\" + token\r\n        };\r\n        fileArray.push(file);\r\n        fileUrlArray.push(url);\r\n      });\r\n      this.fileList = fileArray;\r\n      this.fileUrlList = fileUrlArray;\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n</style>\r\n"]}]}