{"remainingRequest":"E:\\software-engineering\\Software-Engineering-Projects\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\software-engineering\\Software-Engineering-Projects\\admin\\src\\components\\common\\FileUpload.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\software-engineering\\Software-Engineering-Projects\\admin\\src\\components\\common\\FileUpload.vue","mtime":1717153220926},{"path":"E:\\software-engineering\\Software-Engineering-Projects\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1717153210346},{"path":"E:\\software-engineering\\Software-Engineering-Projects\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1717153209461},{"path":"E:\\software-engineering\\Software-Engineering-Projects\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1717153210346},{"path":"E:\\software-engineering\\Software-Engineering-Projects\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1717153219739}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBzdG9yYWdlIGZyb20gIkAvdXRpbHMvc3RvcmFnZSI7CmltcG9ydCBiYXNlIGZyb20gIkAvdXRpbHMvYmFzZSI7CgpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGRpYWxvZ1Zpc2libGU6IGZhbHNlLAogICAgICBkaWFsb2dJbWFnZVVybDogIiIsCiAgICAgIGZpbGVMaXN0OiBbXSwKICAgICAgZmlsZVVybExpc3Q6IFtdLAogICAgICBteUhlYWRlcnM6IHt9CiAgICB9OwogIH0sCiAgcHJvcHM6IFsidGlwIiwgImFjdGlvbiIsICJsaW1pdCIsICJtdWx0aXBsZSIsICJmaWxlVXJscyJdLAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmluaXQoKTsKICAgIHRoaXMubXlIZWFkZXJzID0gewogICAgICAnVG9rZW4nOiBzdG9yYWdlLmdldCgiVG9rZW4iKQogICAgfTsKICB9LAogIHdhdGNoOiB7CiAgICBmaWxlVXJsczogZnVuY3Rpb24odmFsKSB7CiAgICAgIHRoaXMuaW5pdCgpOwogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGdldEFjdGlvblVybCgpIHsKICAgICAgY29uc3QgdXJsID0gYC8ke3RoaXMuJGJhc2UubmFtZX0vYCArIHRoaXMuYWN0aW9uOwogICAgLy9jb25zb2xlLmxvZygnVXBsb2FkIFVSTDonLCB1cmwpOwogICAgcmV0dXJuIHVybDsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGluaXQoKSB7CiAgICAgIGlmICh0aGlzLmZpbGVVcmxzKSB7CiAgICAgICAgdGhpcy5maWxlVXJsTGlzdCA9IHRoaXMuZmlsZVVybHMuc3BsaXQoIiwiKTsKICAgICAgICBsZXQgZmlsZUFycmF5ID0gW107CiAgICAgICAgdGhpcy5maWxlVXJsTGlzdC5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4gewogICAgICAgICAgbGV0IGZpbGUgPSB7CiAgICAgICAgICAgIG5hbWU6IGluZGV4LAogICAgICAgICAgICB1cmw6IGl0ZW0KICAgICAgICAgIH07CiAgICAgICAgICBmaWxlQXJyYXkucHVzaChmaWxlKTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLnNldEZpbGVMaXN0KGZpbGVBcnJheSk7CiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVCZWZvcmVVcGxvYWQoZmlsZSkgewogICAgICBjb25zdCBpc0FsbG93ZWRUeXBlID0gWydpbWFnZS9qcGVnJywgJ2ltYWdlL3BuZycsICdhcHBsaWNhdGlvbi9wZGYnXS5pbmNsdWRlcyhmaWxlLnR5cGUpOwogICAgICBjb25zdCBpc0x0Mk0gPSBmaWxlLnNpemUgLyAxMDI0IC8gMTAyNCA8IDI7CgogICAgICBpZiAoIWlzQWxsb3dlZFR5cGUpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfkuIrkvKDmlofku7blj6rog73mmK8gSlBHLCBQTkcg5oiWIFBERiDmoLzlvI8hJyk7CiAgICAgIH0KICAgICAgaWYgKCFpc0x0Mk0pIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfkuIrkvKDmlofku7blpKflsI/kuI3og73otoXov4cgMk1CIScpOwogICAgICB9CiAgICAgIHJldHVybiBpc0FsbG93ZWRUeXBlICYmIGlzTHQyTTsKICAgIH0sCiAgICBoYW5kbGVVcGxvYWRTdWNjZXNzKHJlcywgZmlsZSwgZmlsZUxpc3QpIHsKICAgICAgLy9jb25zb2xlLmxvZygnVXBsb2FkIFN1Y2Nlc3MgUmVzcG9uc2U6JywgcmVzKTsKICAgICAgaWYgKHJlcyAmJiByZXMuY29kZSA9PT0gMCkgewogICAgICAgIGZpbGVMaXN0W2ZpbGVMaXN0Lmxlbmd0aCAtIDFdWyJ1cmwiXSA9IHRoaXMuJGJhc2UudXJsICsgInVwbG9hZC8iICsgZmlsZS5yZXNwb25zZS5maWxlOwogICAgICAgIHRoaXMuc2V0RmlsZUxpc3QoZmlsZUxpc3QpOwogICAgICAgIHRoaXMuJGVtaXQoImNoYW5nZSIsIHRoaXMuZmlsZVVybExpc3Quam9pbigiLCIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHJlcy5tc2cpOwogICAgICB9CiAgICB9LAogICAgaGFuZGxlVXBsb2FkRXJyKCkgewogICAgICAvL2NvbnNvbGUuZXJyb3IoJ1VwbG9hZCBFcnJvcjonKTsKICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5paH5Lu25LiK5Lyg5aSx6LSlIik7CiAgICB9LAogICAgaGFuZGxlUmVtb3ZlKGZpbGUsIGZpbGVMaXN0KSB7CiAgICAgIHRoaXMuc2V0RmlsZUxpc3QoZmlsZUxpc3QpOwogICAgICB0aGlzLiRlbWl0KCJjaGFuZ2UiLCB0aGlzLmZpbGVVcmxMaXN0LmpvaW4oIiwiKSk7CiAgICB9LAogICAgaGFuZGxlVXBsb2FkUHJldmlldyhmaWxlKSB7CiAgICAgIHRoaXMuZGlhbG9nSW1hZ2VVcmwgPSBmaWxlLnVybDsKICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZTsKICAgIH0sCiAgICBoYW5kbGVFeGNlZWQoKSB7CiAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZyhg5pyA5aSa5LiK5LygICR7dGhpcy5saW1pdH0g5byg5Zu+54mHYCk7CiAgICB9LAogICAgc2V0RmlsZUxpc3QoZmlsZUxpc3QpIHsKICAgICAgbGV0IGZpbGVBcnJheSA9IFtdOwogICAgICBsZXQgZmlsZVVybEFycmF5ID0gW107CiAgICAgIGxldCB0b2tlbiA9IHN0b3JhZ2UuZ2V0KCJ0b2tlbiIpOwogICAgICBmaWxlTGlzdC5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgICAgbGV0IHVybCA9IGl0ZW0udXJsLnNwbGl0KCI/IilbMF07CiAgICAgICAgbGV0IGZpbGUgPSB7CiAgICAgICAgICBuYW1lOiBpdGVtLm5hbWUsCiAgICAgICAgICB1cmw6IHVybCArICI/dG9rZW49IiArIHRva2VuCiAgICAgICAgfTsKICAgICAgICBmaWxlQXJyYXkucHVzaChmaWxlKTsKICAgICAgICBmaWxlVXJsQXJyYXkucHVzaCh1cmwpOwogICAgICB9KTsKICAgICAgdGhpcy5maWxlTGlzdCA9IGZpbGVBcnJheTsKICAgICAgdGhpcy5maWxlVXJsTGlzdCA9IGZpbGVVcmxBcnJheTsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["FileUpload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"FileUpload.vue","sourceRoot":"src/components/common","sourcesContent":["<template>\n  <div>\n    <!-- 上传文件组件 -->\n    <el-upload\n      ref=\"upload\"\n      :action=\"getActionUrl\"\n      list-type=\"picture-card\"\n      :multiple=\"multiple\"\n      :limit=\"limit\"\n      :headers=\"myHeaders\"\n      :file-list=\"fileList\"\n      :on-exceed=\"handleExceed\"\n      :on-preview=\"handleUploadPreview\"\n      :on-remove=\"handleRemove\"\n      :on-success=\"handleUploadSuccess\"\n      :on-error=\"handleUploadErr\"\n      :before-upload=\"handleBeforeUpload\"\n      accept=\".jpg,.jpeg,.png,.pdf\"\n    >\n      <i class=\"el-icon-plus\"></i>\n      <div slot=\"tip\" class=\"el-upload__tip\" style=\"color:#838fa1;\">{{ tip }}</div>\n    </el-upload>\n    <el-dialog :visible.sync=\"dialogVisible\" size=\"tiny\" append-to-body>\n      <img width=\"100%\" :src=\"dialogImageUrl\" alt>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport storage from \"@/utils/storage\";\nimport base from \"@/utils/base\";\n\nexport default {\n  data() {\n    return {\n      dialogVisible: false,\n      dialogImageUrl: \"\",\n      fileList: [],\n      fileUrlList: [],\n      myHeaders: {}\n    };\n  },\n  props: [\"tip\", \"action\", \"limit\", \"multiple\", \"fileUrls\"],\n  mounted() {\n    this.init();\n    this.myHeaders = {\n      'Token': storage.get(\"Token\")\n    };\n  },\n  watch: {\n    fileUrls: function(val) {\n      this.init();\n    }\n  },\n  computed: {\n    getActionUrl() {\n      const url = `/${this.$base.name}/` + this.action;\n    //console.log('Upload URL:', url);\n    return url;\n    }\n  },\n  methods: {\n    init() {\n      if (this.fileUrls) {\n        this.fileUrlList = this.fileUrls.split(\",\");\n        let fileArray = [];\n        this.fileUrlList.forEach((item, index) => {\n          let file = {\n            name: index,\n            url: item\n          };\n          fileArray.push(file);\n        });\n        this.setFileList(fileArray);\n      }\n    },\n    handleBeforeUpload(file) {\n      const isAllowedType = ['image/jpeg', 'image/png', 'application/pdf'].includes(file.type);\n      const isLt2M = file.size / 1024 / 1024 < 2;\n\n      if (!isAllowedType) {\n        this.$message.error('上传文件只能是 JPG, PNG 或 PDF 格式!');\n      }\n      if (!isLt2M) {\n        this.$message.error('上传文件大小不能超过 2MB!');\n      }\n      return isAllowedType && isLt2M;\n    },\n    handleUploadSuccess(res, file, fileList) {\n      //console.log('Upload Success Response:', res);\n      if (res && res.code === 0) {\n        fileList[fileList.length - 1][\"url\"] = this.$base.url + \"upload/\" + file.response.file;\n        this.setFileList(fileList);\n        this.$emit(\"change\", this.fileUrlList.join(\",\"));\n      } else {\n        this.$message.error(res.msg);\n      }\n    },\n    handleUploadErr() {\n      //console.error('Upload Error:');\n      this.$message.error(\"文件上传失败\");\n    },\n    handleRemove(file, fileList) {\n      this.setFileList(fileList);\n      this.$emit(\"change\", this.fileUrlList.join(\",\"));\n    },\n    handleUploadPreview(file) {\n      this.dialogImageUrl = file.url;\n      this.dialogVisible = true;\n    },\n    handleExceed() {\n      this.$message.warning(`最多上传 ${this.limit} 张图片`);\n    },\n    setFileList(fileList) {\n      let fileArray = [];\n      let fileUrlArray = [];\n      let token = storage.get(\"token\");\n      fileList.forEach((item) => {\n        let url = item.url.split(\"?\")[0];\n        let file = {\n          name: item.name,\n          url: url + \"?token=\" + token\n        };\n        fileArray.push(file);\n        fileUrlArray.push(url);\n      });\n      this.fileList = fileArray;\n      this.fileUrlList = fileUrlArray;\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n</style>\n"]}]}